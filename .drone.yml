---
kind: pipeline
name: build

steps:
  # Make sure image builds
  - name: build
    # Use our fork of banzaicloud/drone-kaniko until #17 is merged
    image: katharostech/drone-kaniko

trigger:
  ref:
    exclude:
      - refs/tags/v*
  branch:
    exclude:
      - feature/*

---
kind: pipeline
name: release

steps:
  # Release image to Docker Hub
  - name: release
    image: katharostech/drone-kaniko
    settings:
      repo: katharostech/mysql-backup
      tags: "${DRONE_TAG}, latest"
      username:
        from_secret: docker-username
      password:
        from_secret: docker-password
    when:
      ref:
        - refs/tags/v*

trigger:
  event:
    - tag
  ref:
    - refs/tags/v*

